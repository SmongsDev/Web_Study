package web.exploit.service;

import org.springframework.stereotype.Service;

import web.exploit.entity.Comment;
import web.exploit.repository.CommentRepository;

@Service
public class CommentService {
    private final CommentRepository commentRepository;

    public CommentService(CommentRepository commentRepository) {
        this.commentRepository = commentRepository;
    }

    public Comment save(Comment comment) {
        comment.setContent(escapeHTML(comment.getContent()));
        return commentRepository.save(comment);
    }

    private String escapeHTML(String str) {
        if (str == null) {
            return null;
        }
        return str.replaceAll("&", "&amp;")
                  .replaceAll("<", "&lt;")
                  .replaceAll(">", "&gt;")
                  .replaceAll("\"", "&quot;")
                  .replaceAll("'", "&#039;")
                  .replaceAll("`", "&#x60;")
                  .replaceAll("/", "&#x2F;")
                  .replaceAll("\\\\", "&#x5C;")
                  .replaceAll("=", "&#x3D;")
                  .replaceAll("\\(", "&#x28;")
                  .replaceAll("\\)", "&#x29;")
                  .replaceAll("%", "&#x25;");
    }
}
